<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 0; 
            background-color: #F8F8FC; 
            color: #343A40; 
        }
        .container { 
            background-color: #FFFFFF; 
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.05); 
            max-width: 1300px; 
            margin: 40px auto; 
        }
        h2 { 
            color: #6C63FF; /* ‡∏°‡πà‡∏ß‡∏á */
            border-bottom: 1px solid #E9ECEF; 
            padding-bottom: 10px; 
            margin-bottom: 25px; 
            font-weight: 600; 
        }
        h3 { margin-top: 30px; color: #6C63FF; font-weight: 500; border-bottom: 1px solid #E9ECEF; padding-bottom: 8px; }
        
        /* Action Buttons */
        .admin-actions { display: flex; gap: 10px; margin-bottom: 30px; }
        .admin-actions button { padding: 10px 15px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; transition: background-color 0.2s; }
        .btn-return { background-color: #A29BFE; color: white; } /* ‡∏°‡πà‡∏ß‡∏á‡∏≠‡πà‡∏≠‡∏ô */
        .btn-delete-session { background-color: #DC3545; color: white; } /* ‡πÅ‡∏î‡∏á */

        /* Month Management Card */
        .month-management { border: 1px solid #E9ECEF; padding: 20px; border-radius: 8px; margin-bottom: 40px; background-color: #FBFBFB; }
        .month-management input[type="text"] { border-radius: 4px; border: 1px solid #CED4DA; padding: 10px; width: 180px; margin-right: 10px; display: inline-block; }
        .btn-add { background-color: #64C783; color: white; border: none; } /* ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß */
        .btn-delete { background-color: #FFEBEE; color: #DC3545; border: 1px solid #FF6666; font-weight: 500; } /* ‡∏•‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô */
        
        /* Table Styling */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 0.9em; border-radius: 8px; overflow: hidden; box-shadow: 0 0 10px rgba(0, 0, 0, 0.05); }
        th { background-color: #F0F0F0; color: #495057; padding: 12px 15px; font-weight: 600; text-align: left; border: none; } /* ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏µ‡∏´‡∏±‡∏ß‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
        td { padding: 12px 15px; border-bottom: 1px solid #E9ECEF; text-align: left; }
        
        /* FIX: ‡∏Å‡∏≥‡∏´‡∏ô‡∏î Class ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏ñ‡∏ö‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏µ */
        .row-odd { background-color: #FFFFFF; } 
        .row-even { background-color: #F9F9F9; } 

        /* Status & Action Buttons */
        .status-paid { color: #64C783; font-weight: 600; } 
        .status-unpaid { color: #EF476F; font-weight: 600; } 
        .btn-action-delete { background-color: #FFEBEE; color: #DC3545; padding: 6px 10px; border: 1px solid #FF6666; font-weight: 500; border-radius: 4px; }
        .btn-action-set { background-color: #D4EDDA; color: #155724; padding: 6px 10px; border: 1px solid #64C783; font-weight: 500; border-radius: 4px; }

        /* üí• NEW FIX: Media Query ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÅ‡∏•‡∏∞‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï */
    @media (max-width: 1000px) {
        .container {
            padding: 15px;
            margin: 20px auto;
        }
        .admin-actions {
            flex-wrap: wrap;
        }
        .month-management input[type="text"] {
            width: 100%; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≠‡∏á‡∏Å‡∏£‡∏≠‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏ï‡πá‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á */
            margin-bottom: 10px;
        }
        
        /* ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î */
        table {
            display: block;
            overflow-x: auto; /* ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô‡πÑ‡∏î‡πâ */
            white-space: nowrap; /* ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏ï‡∏Å‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î */
            -webkit-overflow-scrolling: touch; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ö‡∏ô iOS */
        }
        th, td {
            min-width: 120px; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå */
        }
    }
    </style>
</head>
<body>

<div class="container">
    <h2>‚öôÔ∏è ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• (Admin Dashboard)</h2>
    <p style="font-size: 0.9em;">‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö Admin: <strong>{{ user.name }} ({{ user.studentId }})</strong></p>
    
    <div class="admin-actions">
        <a href="{{ url_for('home') }}"><button class="btn-return">‚óÄ ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button></a>
        <a href="{{ url_for('logout') }}"><button class="btn-delete-session">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</button></a>
    </div>

    <hr style="border: 0; border-top: 1px solid #E9ECEF; margin-bottom: 25px;">

    <h3 style="color: #6C63FF;">1. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>

    <div class="month-management">
        <h4>+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏°‡∏≤‡∏ä‡∏¥‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô)</h4>
        <form method="POST" action="{{ url_for('admin_add_month') }}" style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
            <input type="text" name="new_month_id" placeholder="‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡πÄ‡∏ä‡πà‡∏ô 2025-12)" required>
            <input type="text" name="new_month_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡πÄ‡∏ä‡πà‡∏ô ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏° 2568)" required>
            <button type="submit" class="btn-add" style="flex-grow: 0;">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</button>
        </form>
        
        <h4 style="margin-top: 25px;">üóëÔ∏è ‡∏•‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà (üö® ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏≤‡∏ß‡∏£)</h4>
        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            {% if unique_months %}
                {% for month in unique_months %}
                <form method="POST" action="{{ url_for('admin_delete_month') }}" 
                      onsubmit="return confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô {{ month }}? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏´‡∏≤‡∏¢‡πÑ‡∏õ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ñ‡∏≤‡∏ß‡∏£');"
                      style="display: inline-block;">
                    <input type="hidden" name="month_id" value="{{ month }}">
                    <button type="submit" class="btn-delete">‡∏•‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: {{ month }}</button>
                </form>
                {% endfor %}
            {% else %}
                <p style="color: #6C757D; font-size: 0.9em;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡∏•‡∏ö</p>
            {% endif %}
        </div>
    </div>

    <hr style="border: 0; border-top: 1px solid #E9ECEF; margin-bottom: 25px;">

    <h3 style="color: #6C63FF;">2. ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (‡∏ó‡∏∏‡∏Å‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô)</h3>

    <table>
        <thead>
            <tr>
                <th>‡∏£‡∏´‡∏±‡∏™‡∏à‡πà‡∏≤‡∏¢‡πÄ‡∏á‡∏¥‡∏ô (ID)</th>
                <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠</th>
                <th>‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</th>
                <th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for payment in all_payments %}
            <tr class="{% if loop.index is odd %}row-odd{% else %}row-even{% endif %}">
                <td>{{ payment._id }}</td>
                <td>{{ payment.studentId }}</td>
                <td>{{ payment.name }}</td>
                <td>{{ payment.paymentMonth }}</td>
                <td>
                    <span class="{{ 'status-paid' if payment.paid else 'status-unpaid' }}">
                        {{ '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß' if payment.paid else '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏à‡πà‡∏≤‡∏¢' }}
                    </span>
                </td>
                <td>
                    <form method="POST" action="{{ url_for('admin_edit_payment') }}" style="display: inline-block;">
                        <input type="hidden" name="payment_id" value="{{ payment._id }}">
                        
                        {% if payment.paid %}
                            <input type="hidden" name="new_status" value="unpaid">
                            <button type="submit" class="btn-action-delete">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡πà‡∏≤‡∏¢</button>
                        {% else %}
                            <input type="hidden" name="new_status" value="paid">
                            <button type="submit" class="btn-action-set">‡∏ï‡∏±‡πâ‡∏á‡πÄ‡∏õ‡πá‡∏ô '‡∏à‡πà‡∏≤‡∏¢‡πÅ‡∏•‡πâ‡∏ß'</button>
                        {% endif %}
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</body>
</html>
